{% load theming_tags admintools_bootstrap %}
<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE }}" xml:lang="{{ LANGUAGE_CODE }}" {% if LANGUAGE_BIDI %}dir="rtl"{% endif %}>
<head>
<title>{% block title %}{% endblock %}</title>
{% block extrastyle %}{% endblock %}
<!--[if lte IE 7]><link rel="stylesheet" type="text/css" href="{% block stylesheet_ie %}{% load adminmedia %}{% admin_media_prefix %}css/ie.css{% endblock %}" /><![endif]-->
{% if LANGUAGE_BIDI %}<link rel="stylesheet" type="text/css" href="{% block stylesheet_rtl %}{% admin_media_prefix %}css/rtl.css{% endblock %}" />{% endif %}
{#{% render_theming_css %}#}
<script type="text/javascript">window.__admin_media_prefix__ = "{% filter escapejs %}{% admin_media_prefix %}{% endfilter %}";</script>
{% block extrahead %}{% endblock %}
{% block blockbots %}<meta name="robots" content="NONE,NOARCHIVE" />{% endblock %}

<style>
/* Subnav */
.subnav {
  padding: 4px 8px;
  margin-bottom: 15px;
  background-color: #eeeeee; /* Old browsers */
  background-repeat: repeat-x; /* Repeat the gradient */
  background-image: -moz-linear-gradient(top, #f5f5f5 0%, #eeeeee 100%); /* FF3.6+ */
  background-image: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#f5f5f5), color-stop(100%,#eeeeee)); /* Chrome,Safari4+ */
  background-image: -webkit-linear-gradient(top, #f5f5f5 0%,#eeeeee 100%); /* Chrome 10+,Safari 5.1+ */
  background-image: -ms-linear-gradient(top, #f5f5f5 0%,#eeeeee 100%); /* IE10+ */
  background-image: -o-linear-gradient(top, #f5f5f5 0%,#eeeeee 100%); /* Opera 11.10+ */
  filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#f5f5f5', endColorstr='#eeeeee',GradientType=0 ); /* IE6-9 */
  background-image: linear-gradient(top, #f5f5f5 0%,#eeeeee 100%); /* W3C */
  border: 1px solid #e5e5e5;
  -webkit-border-radius: 4px;
     -moz-border-radius: 4px;
          border-radius: 4px;
}

/* Fixed subnav on scroll, but only for 980px and up (sorry IE!) */
@media (min-width: 980px) {
  .subnav-fixed {
    position: fixed;
    top: 40px;
    left: 0;
    right: 0;
    z-index: 1020; /* 10 less than .navbar-fixed to prevent any overlap */
    border-color: #d5d5d5;
    border-width: 0 0 1px; /* drop the border on the fixed edges */
    -webkit-border-radius: 0;
       -moz-border-radius: 0;
            border-radius: 0;
    -webkit-box-shadow: inset 0 1px 0 #fff, 0 1px 5px rgba(0,0,0,.1);
       -moz-box-shadow: inset 0 1px 0 #fff, 0 1px 5px rgba(0,0,0,.1);
            box-shadow: inset 0 1px 0 #fff, 0 1px 5px rgba(0,0,0,.1);
    filter: progid:DXImageTransform.Microsoft.gradient(enabled=false); /* IE6-9 */
  }
  .subnav-fixed .nav {
    width: 938px;
    margin: 0 auto;
    padding: 0 1px;
  }
  .subnav .nav > li:first-child > a,
  .subnav .nav > li:first-child > a:hover {
    -webkit-border-radius: 0;
       -moz-border-radius: 0;
            border-radius: 0;
  }
}

</style>


<script type="text/javascript">
$(function(){

  var django_dismimssPopup = window.dismissAddAnotherPopup;

  window.dismissAddAnotherPopup = function(win, newId, newRepr) {
    var name = windowname_to_id(win.name);
    var elem = document.getElementById(name);
    django_dismimssPopup(win, newId, newRepr);
    $(elem).removeClass('chzn-done');
    $('#' + name + '_chzn').remove();
    $(elem).chosen();
  }

  // menu search

  var nav_menu = $('#navigation-menu');
  var menu_map = [];
  var menu_url_map = {};
  var search_results = $('#menu_search ul');
  var menu_search_visible = false;

  $('#navigation-menu a').not('.dropdown-toggle').each(function(i, a) {
      var line = [a.text.toLowerCase().replace(/^\s+|\s+$/g, ''), a.href];
      menu_map[i] = line;
      menu_url_map[a.href] = a.text.replace(/^\s+|\s+$/g, '');
  });

  $('#menu_search input').keyup(function(e){
    var code = (e.keyCode ? e.keyCode : e.which);
    if (code == 40) {
      // down arrow key
      $('#menu_search ul li a:first').focus();
      return;
    }
    var inp = $(this).val().toLowerCase();
    if (inp == '') { search_results.html(''); return; }
    var results = "";
    var highlight_re = new RegExp('(' + inp + ')', 'ig');
    var cnt = 0;
    var unique_map = {};
    $(menu_map).each(function(i, e){
      if ((-1 != e[0].indexOf(inp)) && (cnt < 10)) {
        if (unique_map[e[1]]) { return; }
        var txt = menu_url_map[e[1]].replace(highlight_re, '<span class="highlight">$1</span>');
        results = results + '<li><a href="' + e[1] + '">' + txt + '</a></li>';
        unique_map[e[1]] = true;
        cnt ++;
      }
    });
    search_results.html(results);
  });

  $('#menu_search ul li a').live('keydown', function(e){
    var code = (e.keyCode ? e.keyCode : e.which);
    if (code == 40) {
      e.preventDefault();
      $(this).parent().next().children('a').focus();
    }
    if (code == 38) {
      e.preventDefault();
      $(this).parent().prev().children('a').focus();
    }
  });

  $('#menu_search ul li a').live('mouseover', function(e){
    $(this).focus();
  });

  $('#menu-search-toggle').click(function(e){
    e.preventDefault();
    menu_search_visible = ! menu_search_visible;
    $('#menu_search').toggle(menu_search_visible);
    if (menu_search_visible) {
      $(this).twipsy('hide');
      $('#menu_search input').focus();
    } 
  });

  $('fieldset label').addClass('control-label');

  var isFixed = false,
      $win = $(window),
      subNav = $(".subnav"),
      fieldSets = subNav.siblings("section.field_sets"),
      navTop = subNav.offset().top - $("#header").height();

  var processScroll = function() {
    if ($win.width() < 980) {
      return
    }
    var scrollTop = $win.scrollTop();
    if (!isFixed && scrollTop >= navTop) {
      isFixed = true;
      subNav.addClass("subnav-fixed");
      fieldSets.css({"margin-top": subNav.outerHeight(true) + "px" });

    } else if (isFixed && scrollTop < navTop) {
      isFixed = false;
      fieldSets.css({"margin-top": "0"});
      subNav.removeClass("subnav-fixed");
    }
  }
  $win.on("scroll", processScroll);
});
</script>
</head>
{% load i18n %}

<body class="{% if is_popup %}popup {% endif %}{% block bodyclass %}{% endblock %}">

<!-- Container -->
<div id="container" class="container-fluid{% if is_popup %} container-popup{% endif %}">
    {% if not is_popup %}
    <!-- Header -->
    <div id="header" class="navbar navbar-fixed-top" data-dropdown="dropdown">
      <div class="navbar-inner">
      <div class="container-fluid">
        {% block branding %}{% endblock %}
        {% block nav-global %}{% endblock %}
        {% block search %}{% endblock %}
        {% if user.is_active and user.is_staff %}
        <ul class="nav pull-right">
          {% comment %}
            <li id="menu-search-container">
              <a href="#" id="menu-search-toggle" class="top-icon" title="{% trans "Menu Search" %}" rel="popover" data-placement="below"><span class="ui-icon ui-icon-search"></span></a>
              <div id="menu_search">
                <input type="text" placeholder="{% trans "Search in menu" %}"/>
                <ul></ul>
              </div>
            </li>
          {% endcomment %}
            {% atb_site_link %}
            <li class="dropdown">
              <a class="dropdown-toggle" href="#" data-toggle="dropdown">
                <i class="icon-user icon-white"></i>
                {% filter force_escape %}{% firstof user.first_name user.username %}{% endfilter %}
                <b class="caret"></b>
              </a>
              <ul class="dropdown-menu">
              {% block userlinks %}
                  {% url django-admindocs-docroot as docsroot %}
                  {% if docsroot %}
                      <li><a href="{{ docsroot }}">{% trans 'Documentation' %}</a></li>
                  {% endif %}
                  {% url admin:password_change as password_change_url %}
                  <li>
                    {% if password_change_url %}
                        <a href="{{ password_change_url }}">
                    {% else %}
                        <a href="{{ root_path }}password_change/">
                    {% endif %}
                    <i class="icon-lock"></i>
                    {% trans 'Change password' %}</a>
                  </li>
                  {% url admin:logout as logout_url %}
                  <li>
                    {% if logout_url %}
                        <a href="{{ logout_url }}">
                    {% else %}
                        <a href="{{ root_path }}logout/">
                    {% endif %}
                    <i class="icon-off"></i>
                    {% trans 'Log out' %}</a>
                  </li>
              {% endblock %}
              </ul>
            </li>
        </ul>
        {% endif %}
      </div>
      </div>
    </div>
    <!-- END Header -->
      {% breadcrumbs %}
      {% block breadcrumbs %}
        /|{% trans "Home" %}
        {% if title %}{{ title }}{% endif %}
      {% endblock %}
      {% endbreadcrumbs %}
    {% endif %}

    <div class="main-container">
        {% block messages %}
          {% if messages %}
              {% for message in messages %}
                <div class="alert alert-{{ message.tags }}" data-alert="alert"><a class="close" href="#">&times;</a>{{ message }}</div>
              {% endfor %}
          {% endif %}
        {% endblock %}

      <!-- Content -->
      <div id="content" class="{% block coltype %}container-fluid{% endblock %}">
          {% block pretitle %}{% endblock %}
          {% block content_title %}
            {% if title %}
              <h3 class="well page-top">
                {% block object-tools %}{% endblock %}
                {{ title }}
              </h3>
            {% endif %}
          {% endblock %}
          {% block content %}
          {{ content }}
          {% endblock %}
          {% block sidebar %}{% endblock %}
          <br class="clear" />
      </div>
      <!-- END Content -->

      {% block footer %}<div id="footer"></div>{% endblock %}
    </div>
</div>
<!-- END Container -->

</body>
</html>
